<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Support functions for analysis of FAFB EM segmentation • fafbseg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Support functions for analysis of FAFB EM segmentation">
<meta property="og:description" content="Functions that read some of the raw data formats produced by Google
  electron microscopy segmentation tools as displayed by neuroglancer and then
  allow basic 3D visualisation and analysis.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">fafbseg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
<li>
  <a href="SUPPORT.html">Help</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://natverse.github.io">natverse</a>
</li>
<li>
  <a href="https://github.com/jefferis/fafbseg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="fafbseg" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#fafbseg" class="anchor"></a>fafbseg</h1></div>
<p>The goal of fafbseg is to provide support for analysis of segmented EM data. This includes support for working with <a href="https://github.com/google/neuroglancer">neuroglancer</a> mesh data for the <a href="http://temca2data.org/">full adult female brain dataset</a>. It is integrated with the <a href="https://github.com/jefferis/nat">NeuroAnatomy Toolbox</a> suite especially <a href="https://github.com/jefferis/elmr">elmr</a> and <a href="https://github.com/jefferis/rcatmaid">catmaid</a>.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version of fafbseg from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># install devtools if required</span>
<span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"remotes"</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"jefferis/fafbseg"</span>)</pre></div>
</div>
<div id="use" class="section level2">
<h2 class="hasAnchor">
<a href="#use" class="anchor"></a>Use</h2>
<div id="neuroglancer-urls" class="section level3">
<h3 class="hasAnchor">
<a href="#neuroglancer-urls" class="anchor"></a>Neuroglancer URLs</h3>
<p>You can use the package to generate URLs pointing to a defined location in a neuroglancer dataset. This includes arbitrary locations in the FAFB dataset specified interactively or using CATMAID URLs. For example, we could find the location referenced in this tweet:</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Zoom into <a href="https://twitter.com/dddavi?ref_src=twsrc%5Etfw">@dddavi</a> whole fly brain EM dataset using public <a href="https://twitter.com/catmaid?ref_src=twsrc%5Etfw">@catmaid</a> server hosted by <a href="https://twitter.com/virtualflybrain?ref_src=twsrc%5Etfw">@virtualflybrain</a>. From whole brain view to synaptic detail. Click to explore this location within the the mushroom body parallel fibre system yourself! <a href="https://t.co/JxsBGe3RbJ">https://t.co/JxsBGe3RbJ</a> <a href="https://twitter.com/flyconnectome?ref_src=twsrc%5Etfw">@flyconnectome</a> <a href="https://t.co/NfDiXgJOPX">pic.twitter.com/NfDiXgJOPX</a>
</p>
— Greg Jefferis (@gsxej) <a href="https://twitter.com/gsxej/status/1021743042296983552?ref_src=twsrc%5Etfw">July 24, 2018</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fafbseg</span>)
<span class="co"># First, optionally set a package option with an example neuroglancer URL for your dataset.</span>
<span class="co"># This URL will define the image layers that are visible. You need to use an</span>
<span class="co"># URL for which you have access. The package ships with a default using segmentation</span>
<span class="co"># fafb_v14:fafb_v14_16nm_v00c_split3xfill2 which is probably what you need.</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">fafbseg.sampleurl</span><span class="kw">=</span><span class="st">"https://&lt;neuroglancerlurl&gt;"</span>)

<span class="co"># Now open location specified by CATMAID URL</span>
<span class="no">u</span><span class="kw">=</span><span class="st">'https://fafb.catmaid.virtualflybrain.org/?pid=2&amp;zp=131280&amp;yp=170014.98879622458&amp;xp=426584.81386896875&amp;tool=navigator&amp;sid0=2&amp;s0=-1'</span>
<span class="fu"><a href="reference/open_fafb_ngl.html">open_fafb_ngl</a></span>(<span class="no">u</span>)

<span class="co"># or display raw coordinates that you can paste into active Neuroglancer session</span>
<span class="fu"><a href="reference/open_fafb_ngl.html">open_fafb_ngl</a></span>(<span class="no">u</span>, <span class="kw">coords.only</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></div>
</div>
<div id="catmaid-urls" class="section level3">
<h3 class="hasAnchor">
<a href="#catmaid-urls" class="anchor"></a>CATMAID URLs</h3>
<p>You can also go in the opposite direction to convert a neuroglancer location into a CATMAID URL. The neuroglancer location can come either from a URL or the JSON scene specification obtained by clicking on the <em>{}</em> icon.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="co"># round trip using the CATMAID URL we used earlier</span>
<span class="no">ngu</span> <span class="kw">=</span> <span class="fu"><a href="reference/open_fafb_ngl.html">open_fafb_ngl</a></span>(<span class="no">u</span>, <span class="kw">open</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># now open using elmr package - installed like so if necessary: </span>
<span class="co"># if (!require("devtools")) install.packages("devtools") </span>
<span class="co"># devtools::install_github("jefferis/elmr")</span>
<span class="kw pkg">elmr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/elmr/man/open_fafb.html">open_fafb</a></span>(<span class="fu"><a href="reference/ngl_decode_scene.html">ngl_decode_scene</a></span>(<span class="no">ngu</span>))</pre></div>
</div>
<div id="shiny-application" class="section level3">
<h3 class="hasAnchor">
<a href="#shiny-application" class="anchor"></a>Shiny application</h3>
<p>The package now includes a simple Shiny application that translates between the two URL schemes. You can use an online version of the app at</p>
<p><a href="https://jefferislab.shinyapps.io/CATMAID-Neuroglancer-Converter/" class="uri">https://jefferislab.shinyapps.io/CATMAID-Neuroglancer-Converter/</a></p>
<p>or download from GitHub and run locally the latest version of the app:</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"shiny"</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"shiny"</span>)
<span class="kw pkg">shiny</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/runUrl.html">runGitHub</a></span>(<span class="st">"jefferis/fafbseg"</span>, <span class="kw">subdir</span> <span class="kw">=</span> <span class="st">"inst/app/"</span>)</pre></div>
</div>
<div id="analysis-of-neuroglancer-meshes" class="section level3">
<h3 class="hasAnchor">
<a href="#analysis-of-neuroglancer-meshes" class="anchor"></a>Analysis of neuroglancer meshes</h3>
<p>Currently the package provides functionality to read neuroglancer meshes into R and then compare such meshes with traced neuron objects e.g. from CATMAID.</p>
<p>At the moment there is no support for reading objects directly from a neuroglancer scene URL. Therefore you must capture an interactive web session. You should make sure that you only have one neuron displayed if you do not want to have to parse the object identifier relationships.</p>
<p>With Chrome you can generate an appropriate set of curl download commands by:</p>
<ol>
<li>Opening the Chrome Developer console (View … Developer … JavaScript Console),</li>
<li>(re)loading a page of interest</li>
<li>selecting the network tab</li>
<li>selecting a downloaded object</li>
<li>right clicking and then choosing (Copy … <strong>Copy all as cURL</strong>).</li>
</ol>
<p>You can either save the contents of the clipboard into a text file (e.g. <code>all_curl.sh</code>) or just keep it in the clipboard.</p>
<p>You can then go to R and proceed as follows</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fafbseg</span>)
<span class="co"># omit the first argument if you want to use the clipboard</span>
<span class="fu"><a href="reference/fetch_all_curl.html">fetch_all_curl</a></span>(<span class="st">"all_curl.sh"</span>, <span class="kw">outdir</span><span class="kw">=</span><span class="st">"alldata"</span>,
  <span class="kw">regex</span><span class="kw">=</span><span class="st">"brainmaps.googleapis.com"</span>, <span class="kw">fixed</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="no">meshdata</span><span class="kw">=</span><span class="fu"><a href="reference/read_ng_dump.html">read_ng_dump</a></span>(<span class="st">"alldata"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">elmr</span>)
<span class="no">y</span><span class="kw">=</span><span class="fu">read.neuron.catmaid</span>(<span class="fl">23432</span>)
<span class="fu"><a href="reference/compare_ng_neuron.html">compare_ng_neuron</a></span>(<span class="no">meshdata</span>, <span class="no">y</span>)</pre></div>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/jefferis/fafbseg/">https://​github.com/​jefferis/​fafbseg/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/jefferis/fafbseg/issues">https://​github.com/​jefferis/​fafbseg/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Gregory Jefferis <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0587-9355" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="http://jefferis.github.io/fafbseg/reference/"><img src="https://img.shields.io/badge/docs-100%25-brightgreen.svg" alt="Docs"></a></li>
<li><a href="https://travis-ci.org/jefferis/fafbseg"><img src="https://travis-ci.org/jefferis/fafbseg.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://coveralls.io/r/jefferis/fafbseg?branch=master"><img src="https://coveralls.io/repos/github/jefferis/fafbseg/badge.svg" alt="Coveralls test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
