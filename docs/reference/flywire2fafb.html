<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Map points in  FlyWire v1 TO FAFB14 space (xyz nm) — flywire2fafb • fafbseg</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Map points in  FlyWire v1 TO FAFB14 space (xyz nm) — flywire2fafb" />
<meta property="og:description" content="Map points in  FlyWire v1 TO FAFB14 space (xyz nm)" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fafbseg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/capturing-ngl-meshes.html">Capturing neuroglancer meshes from a browser scene</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../SUPPORT.html">Help</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://natverse.github.io">natverse</a>
</li>
<li>
  <a href="https://github.com/natverse/fafbseg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Map points in  FlyWire v1 TO FAFB14 space (xyz nm)</h1>
    <small class="dont-index">Source: <a href='https://github.com/natverse/fafbseg/blob/master/R/flywire-coord.R'><code>R/flywire-coord.R</code></a></small>
    <div class="hidden name"><code>flywire2fafb.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Map points in  FlyWire v1 TO FAFB14 space (xyz nm)</p>
    </div>

    <pre class="usage"><span class='fu'>flywire2fafb</span>(
  <span class='no'>xyz</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mapmany"</span>, <span class='st'>"map1"</span>),
  <span class='kw'>chunksize</span> <span class='kw'>=</span> <span class='fl'>200</span>,
  <span class='kw'>swap</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>xyz</th>
      <td><p>A Nx3 matrix of points</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Whether to map many points at once (default) or just one</p></td>
    </tr>
    <tr>
      <th>chunksize</th>
      <td><p>The number of points to send to the server when mapping many
points at once.</p></td>
    </tr>
    <tr>
      <th>swap</th>
      <td><p>When <code>TRUE</code> applies the deformation field in the opposite
direction e.g. to give a coarse mapping of points FAFB-&gt;FlyWire. This is
wrong but may be useful.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to httr::GET/POST operation</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>an Nx3 matrix of points</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Note that you can also access FlyWire-&gt;FAFB bridging registration
  via the <code>xform_brain</code> series of functions. This will allow you
  to transform most kinds of 3D data objects, whereas the <code>flywire2fafb</code>
  function is restricted to plain 3D coordinates. See examples.</p>
<p>Mapping single points is unlikely to be useful, but you may wish to adjust
  the <code>chunksize</code> argument to send more points at once at the risk of
  possible server timeouts. The value of 200 is quite conservative.</p>
<p>When <code>swap=TRUE</code> displacements will be applied in the opposite
  direction to what is intended. This can be used to provide a coarse
  FAFB-&gt;FlyWire mapping if you feed in FAFB points. This is wrong but may be
  useful as it can get you closer to the right place in FlyWire than just
  assuming that FAFB14 and FlyWire are in the same space. This works because
  deformations are mostly fairly smooth at the scale of FAFB-FlyWire
  displacements. Operationally we find that residual displacements are
  typically of the order 100 nm using this procedure.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># identified location in FAFB14</span>
<span class='no'>p.fafb.nm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fl'>477042</span>, <span class='fl'>284535</span>, <span class='fl'>90680</span>)
<span class='no'>p.fafb.raw</span> <span class='kw'>&lt;-</span> <span class='no'>p.fafb.nm</span>/<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>,<span class='fl'>4</span>,<span class='fl'>40</span>)
<span class='co'># corresponding location in FlyWire</span>
<span class='no'>p.flywire.raw</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fl'>118865</span>, <span class='fl'>71338</span>, <span class='fl'>2267</span>)
<span class='no'>p.flywire.nm</span> <span class='kw'>&lt;-</span> <span class='no'>p.flywire.raw</span> * <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>,<span class='fl'>4</span>,<span class='fl'>40</span>)

<span class='co'># check displacement</span>
<span class='fu'>flywire2fafb</span>(<span class='no'>p.flywire.nm</span>)-<span class='no'>p.fafb.nm</span></div><div class='output co'>#&gt;      X  Y Z
#&gt; [1,] 3 -1 0</div><div class='input'>
<span class='co'># check displacement for "fake inverse"</span>
<span class='co'># NB this is not a proper FAFB-&gt;FlyWire mapping  (see details)</span>
<span class='fu'>flywire2fafb</span>(<span class='no'>p.fafb.nm</span>, <span class='kw'>swap</span><span class='kw'>=</span><span class='fl'>TRUE</span>)-<span class='no'>p.flywire.nm</span></div><div class='output co'>#&gt; <span class='warning'>Warning: The FAFB-&gt;FlyWire transform is wrong but useful. See ?flywire2fafb</span></div><div class='output co'>#&gt;        X  Y Z
#&gt; [1,] 114 19 0</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"AV4b1"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>'catmaid'</span>)
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>42</span>)
<span class='no'>before</span><span class='kw'>=</span><span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span>(<span class='no'>AV4b1</span>)[<span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'>nvertices</span>(<span class='no'>AV4b1</span>), <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>2000</span>), ]
<span class='no'>after</span><span class='kw'>=</span><span class='fu'>flywire2fafb</span>(<span class='no'>before</span>, <span class='kw'>swap</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>d</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span>((<span class='no'>before</span>-<span class='no'>after</span>)^<span class='fl'>2</span>))
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='no'>d</span>, <span class='kw'>br</span><span class='kw'>=</span><span class='fl'>20</span>)</div><div class='img'><img src='flywire2fafb-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='no'>AV4b1.flywire</span> <span class='kw'>&lt;-</span> <span class='fu'>xform_brain</span>(<span class='no'>AV4b1</span>, <span class='kw'>reference</span><span class='kw'>=</span><span class='st'>"FlyWire"</span>, <span class='kw'>sample</span><span class='kw'>=</span><span class='st'>"FAFB14"</span>)
<span class='fu'>plot3d</span>(<span class='fu'>neuronlist</span>(<span class='no'>AV4b1.flywire</span>, <span class='no'>AV4b1</span>))
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


